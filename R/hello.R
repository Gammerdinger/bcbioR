# Hello, world!
#
# This is an example function named 'hello'
# which prints 'Hello, world!'.
#
# You can learn more about package authoring with RStudio at:
#
#   http://r-pkgs.had.co.nz/
#
# Some useful keyboard shortcuts for package authoring:
#
#   Install Package:           'Cmd + Shift + B'
#   Check Package:             'Cmd + Shift + E'
#   Test Package:              'Cmd + Shift + T'

.fix <- function(x){
  x <- tolower(x) %>% str_replace_all(., "[[:punct:]]", "_")
  return(x)
}

#' @export
bcbio_set_project <- function() {
  hbc_code <- readline("What is the hbc code:\n")
  hbc_code <- paste0("hbc", hbc_code)
  pi <- readline("What is PI last name:\n")
  technology <- readline("What is the technology:\n")
  tissue <- readline("What is the tissue:\n")
  org <- readline("What is the organism:\n")
  project <- readline("What is the project name:\n")
  #dropbox <- readline("What is the dropbox name:\n")
  #github_org <- readline("What is the github organization:\n")
  #hbc_$technology_of_$pilastname_$intervention_on_$tissue_in_$organism_$hbccode
  project_full <- paste(technology, .fix(pi), .fix(project), tissue, org, hbc_code, sep="_")
  #github <- c(github_org,project_full)
  opts <- list(code=hbc_code, project=project_full)
               #dropbox=file.path(dropbox,project_full),
               #github=github)
  print(opts)
  return(opts)
}

#' @export
bcbio_start_project <- function(options) {

}

#' @export
bcbio_gitignore <- function(options) {

}


hello <- function() {
  print("Hello, world!")

}

# This function showcases how one might write a function to be used as an
# RStudio project template. This function will be called when the user invokes
# the New Project wizard using the project template defined in the template file
# at:
#
#   inst/rstudio/templates/project/hello_world.dcf
#
# The function itself just echos its inputs and outputs to a file called INDEX,
# which is then opened by RStudio when the new project is opened.
rnaseq <- function(path, ...) {

  # ensure path exists
  dir.create(path, recursive = TRUE, showWarnings = FALSE)

  # generate header
  header <- c(
    "# This file was generated by a call to 'ptexamples::hello_world()'.",
    "# The following inputs were received:",
    ""
  )

  # collect inputs
  dots <- list(...)
  text <- lapply(seq_along(dots), function(i) {
    key <- names(dots)[[i]]
    val <- dots[[i]]
    paste0(key, ": ", val)
  })

  # collect into single text string
  contents <- paste(
    paste(header, collapse = "\n"),
    paste(text, collapse = "\n"),
    sep = "\n"
  )

  # write to index file
  writeLines(contents, con = file.path(path, "README.md"))

}
